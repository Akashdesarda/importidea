
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
      
        <meta name="author" content="Akash Desarda">
      
      
      <link rel="shortcut icon" href="../../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.1.2, mkdocs-material-7.0.4">
    
    
      
        <title>Retrieve Azure Devops Pipeline current/older metadata - import idea</title>
      
    
    
      <link rel="stylesheet" href="../../assets/stylesheets/main.77f3fd56.min.css">
      
        
        <link rel="stylesheet" href="../../assets/stylesheets/palette.7fa14f5b.min.css">
        
          
          
          <meta name="theme-color" content="#ff6e42">
        
      
    
    
    
      
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,400,400i,700%7CRoboto+Mono&display=fallback">
        <style>:root{--md-text-font-family:"Roboto";--md-code-font-family:"Roboto Mono"}</style>
      
    
    
    
    
      
    
    
  </head>
  
  
    
    
    
    
    
    <body dir="ltr" data-md-color-scheme="preference" data-md-color-primary="deep-orange" data-md-color-accent="green">
      
        <script>matchMedia("(prefers-color-scheme: dark)").matches&&document.body.setAttribute("data-md-color-scheme","slate")</script>
      
  
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#1-the-problem" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
      

<header class="md-header" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href="../.." title="import idea" class="md-header__button md-logo" aria-label="import idea">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54z"/></svg>

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            import idea
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              Retrieve Azure Devops Pipeline current/older metadata
            
          </span>
        </div>
      </div>
    </div>
    <div class="md-header__options">
      
    </div>
    
      <label class="md-header__button md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5z"/></svg>
      </label>
      
<div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" data-md-state="active" required>
      <label class="md-search__icon md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5z"/></svg>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg>
      </label>
      <button type="reset" class="md-search__icon md-icon" aria-label="Clear" tabindex="-1">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41L17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41z"/></svg>
      </button>
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
    
    
  </nav>
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    




<nav class="md-nav md-nav--primary" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="../.." title="import idea" class="md-nav__button md-logo" aria-label="import idea">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54z"/></svg>

    </a>
    import idea
  </label>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../.." class="md-nav__link">
        Home
      </a>
    </li>
  

    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_2" type="checkbox" id="__nav_2" >
      
      <label class="md-nav__link" for="__nav_2">
        Articles
        <span class="md-nav__icon md-icon"></span>
      </label>
      <nav class="md-nav" aria-label="Articles" data-md-level="1">
        <label class="md-nav__title" for="__nav_2">
          <span class="md-nav__icon md-icon"></span>
          Articles
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../programming/" class="md-nav__link">
        Programming
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../tools/" class="md-nav__link">
        Tools
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../misc/" class="md-nav__link">
        Miscellaneous
      </a>
    </li>
  

          
            
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_2_4" type="checkbox" id="__nav_2_4" >
      
      <label class="md-nav__link" for="__nav_2_4">
        Category
        <span class="md-nav__icon md-icon"></span>
      </label>
      <nav class="md-nav" aria-label="Category" data-md-level="2">
        <label class="md-nav__title" for="__nav_2_4">
          <span class="md-nav__icon md-icon"></span>
          Category
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../tags.html" class="md-nav__link">
        Tags
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../author_tags.md" class="md-nav__link">
        Author
      </a>
    </li>
  

          
        </ul>
      </nav>
    </li>
  

          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../../about/" class="md-nav__link">
        About
      </a>
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    
<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#1-the-problem" class="md-nav__link">
    1. The Problem
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#2-the-solution" class="md-nav__link">
    2. The Solution
  </a>
  
    <nav class="md-nav" aria-label="2. The Solution">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#21-personal-access-token-pat" class="md-nav__link">
    2.1 Personal Access Token (PAT)
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#22-creating-azure-devops-client" class="md-nav__link">
    2.2 Creating Azure devops client
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#23-retrieve-builds" class="md-nav__link">
    2.3 Retrieve Builds
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#24-pooling-mechanism" class="md-nav__link">
    2.4 Pooling Mechanism
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#3-integration-with-pipeline" class="md-nav__link">
    3. Integration with Pipeline
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          <div class="md-content" data-md-component="content">
            <article class="md-content__inner md-typeset">
              
                
                
                  <h1>Retrieve Azure Devops Pipeline current/older metadata</h1>
                
                <details class="success inline"><summary>Date</summary><p>17<sup>t</sup><sup>h</sup> April, 2021</p>
</details>
<details class="success inline end"><summary>Author</summary><p>Akash Desarda</p>
</details>
<p><br>
<br>
<br></p>
<h2 id="1-the-problem">1. The Problem</h2>
<div class="admonition note">
<p>I believe to better understand any blog, understanding its original requirement is essential.</p>
</div>
<p>We use serval microservices in our application which is finally deployment using kubernetes. Each microservices has two CI pipeline:</p>
<ol>
<li><strong>Base pipeline</strong>: Used to install all dependencies.</li>
<li><strong>Build pipeline</strong>: Used to build service on top of <em>base pipeline</em>.</li>
</ol>
<p>Now, the frequency to run <em>base pipeline</em> as compared to <em>build pipeline</em> is rare as dependencies changes very rarely. Both <em>base pipeline</em> and <em>build pipeline</em> produces docker images as end result which is finally push to our container registry. If pipelines fails then its respective docker image is not pushed.</p>
<p>Initially, I used to manually check them every time. Its not that daunting as it sounds as there were few checks in place,</p>
<ol>
<li>
<p>Docker image in <em>build pipeline</em> is build on top docker image from <em>base pipeline</em>. So even if latest <em>base pipeline</em> fails, <em>build pipeline</em> will simply pulled an earlier successfully pushed image.</p>
</li>
<li>
<p>In some rare scenario where if both the pipeline is triggered at the same time then I have to manually pause the <em>build pipeline</em> till <em>base pipeline</em> is not succeeded. Now this is <strong>defeating the purpose of automation via CI pipeline</strong> 😭</p>
</li>
</ol>
<p>As I mentioned earlier, <em>base pipeline</em> can pull docker image from repository no matter what is the status of <em>base pipeline</em>. This is done intentionally so that the CI pipeline will not break. But this also gave rise harmful design flaw. Ideally <em>build pipeline</em> must have all the latest packages and utilities installed. Smart people can definitely smell a trade-off here.</p>
<p><em>So lets summarize into an checklist which can solve all this problems, ideally he </em><em>build pipeline</em><em> should check following checklist before staring its xecution:</em></p>
<ul class="task-list">
<li class="task-list-item"><label class="task-list-control"><input type="checkbox" disabled checked/><span class="task-list-indicator"></span></label> Is the <em>base pipeline</em> running?  </li>
<li>If running then wait and check after some interval using pooling mechanism</li>
<li>Resume as soon as <em>base pipeline</em> succeeds</li>
<li class="task-list-item"><label class="task-list-control"><input type="checkbox" disabled checked/><span class="task-list-indicator"></span></label> What is status of latest completed <em>base pipeline</em>?</li>
<li>If it is succeeded then continue</li>
<li>If it is failed then stop <em>build pipeline</em></li>
</ul>
<hr />
<h2 id="2-the-solution">2. The Solution</h2>
<p>After going through the problem now its time to go through the solution.</p>
<h3 id="21-personal-access-token-pat">2.1 Personal Access Token (PAT)</h3>
<p>We'll need PAT to establish connection with Azure DevOps and create its client. Follow this <a href="https://docs.microsoft.com/en-us/azure/devops/organizations/accounts/use-personal-access-tokens-to-authenticate?view=azure-devops&amp;tabs=preview-page" title="Create a PAT">official guide</a> from Microsoft to create one. Make sure the PAT must have <strong>Read access</strong> for <strong>Build</strong> and <strong>Release</strong>. You can enable it from <strong>Edit &gt; Scopes</strong>.</p>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p>Make sure not to loose the PAT token key. As it is not stored anywhere an Azure devops and can be only copied once at the time of creation.</p>
</div>
<h3 id="22-creating-azure-devops-client">2.2 Creating Azure devops client</h3>
<p>Azure DevOps provide extensive support through its <a href="https://docs.microsoft.com/en-us/rest/api/azure/devops/?view=azure-devops-rest-6.1" title="Azure DevOps REST api">REST api</a> 🚀. We can directly use REST api over HTTPS operation, but we can't build custom logic around it. So instead I am using <a href="https://github.com/microsoft/azure-devops-python-api">Azure DevOps Python API</a></p>
<p>Lets see how to create the client</p>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span>1
2
3
4
5
6
7
8</pre></div></td><td class="code"><div class="highlight"><pre><span></span><code><span class="kn">from</span> <span class="nn">azure.devops.connection</span> <span class="kn">import</span> <span class="n">Connection</span>
<span class="kn">from</span> <span class="nn">msrest.authentication</span> <span class="kn">import</span> <span class="n">BasicAuthentication</span>

<span class="c1"># Setting up client to connect Azure devops </span>
<span class="n">credentials</span> <span class="o">=</span> <span class="n">BasicAuthentication</span><span class="p">(</span><span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="s1">&#39;YOURPAT&#39;</span><span class="p">)</span>
<span class="n">connection</span> <span class="o">=</span> <span class="n">Connection</span><span class="p">(</span><span class="n">base_url</span><span class="o">=</span><span class="s2">&quot;&lt;https://dev.azure.com/YOURORG&gt;&quot;</span><span class="p">,</span> <span class="n">creds</span><span class="o">=</span><span class="n">credentials</span><span class="p">)</span>
<span class="n">core_client</span> <span class="o">=</span> <span class="n">connection</span><span class="o">.</span><span class="n">clients</span><span class="o">.</span><span class="n">get_core_client</span><span class="p">()</span>
<span class="n">build_client</span> <span class="o">=</span> <span class="n">connection</span><span class="o">.</span><span class="n">clients</span><span class="o">.</span><span class="n">get_build_client</span><span class="p">()</span>
</code></pre></div>
</td></tr></table>
<h3 id="23-retrieve-builds">2.3 Retrieve Builds</h3>
<p>Here I will retrieve specific builds of in focus <em>base pipeline</em> with the help of filters. The best part of this REST api is that they are updated instantly 😍.</p>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span>1
2
3
4
5
6
7</pre></div></td><td class="code"><div class="highlight"><pre><span></span><code> <span class="n">builds</span> <span class="o">=</span> <span class="n">build_client</span><span class="o">.</span><span class="n">get_builds</span><span class="p">(</span>
        <span class="n">project</span><span class="o">=</span><span class="s2">&quot;&lt;Your project name&gt;&quot;</span><span class="p">,</span>
        <span class="n">repository_id</span><span class="o">=&lt;</span><span class="n">Your</span> <span class="n">repo</span> <span class="nb">id</span><span class="o">&gt;</span><span class="p">,</span>
        <span class="n">repository_type</span><span class="o">=</span><span class="s2">&quot;TfsGit&quot;</span><span class="p">,</span> <span class="c1"># For git based repo</span>
        <span class="n">branch_name</span><span class="o">=</span><span class="s2">&quot;refs/heads/develop&quot;</span><span class="p">,</span> <span class="c1"># IF you want to retrieve build run for specif branch. In my case it is develop. ⚠ Do not remove &#39;refs/heads/&#39;</span>
        <span class="n">definitions</span><span class="o">=</span><span class="p">[</span><span class="o">&lt;</span><span class="n">Your</span> <span class="n">pipeline</span><span class="s1">&#39;s definitionId&gt;],</span>
    <span class="p">)</span>
</code></pre></div>
</td></tr></table>
<div class="admonition tip">
<p class="admonition-title">Tip</p>
<p>I struggled a bit for searching 'definitionId'. But there's a neat trick, just goto your pipeline's build page (where it shows all history of runs) and in the url you will find it.</p>
</div>
<h3 id="24-pooling-mechanism">2.4 Pooling Mechanism</h3>
<p>This is the most critical part as it will ensure to tick all element from the above checklist. The script first checks result of last build and if its not in failed state then continue to check status for completion. This step is repeated for every 10 seconds with timeout of 30m</p>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33</pre></div></td><td class="code"><div class="highlight"><pre><span></span><code><span class="k">for</span> <span class="n">step_time</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="mi">1810</span><span class="p">,</span> <span class="mi">10</span><span class="p">)):</span>

    <span class="n">builds</span> <span class="o">=</span> <span class="n">build_client</span><span class="o">.</span><span class="n">get_builds</span><span class="p">(</span>
        <span class="n">project</span><span class="o">=</span><span class="s2">&quot;&lt;Your project name&gt;&quot;</span><span class="p">,</span>
        <span class="n">repository_id</span><span class="o">=&lt;</span><span class="n">Your</span> <span class="n">repo</span> <span class="nb">id</span><span class="o">&gt;</span><span class="p">,</span>
        <span class="n">repository_type</span><span class="o">=</span><span class="s2">&quot;TfsGit&quot;</span><span class="p">,</span>
        <span class="n">branch_name</span><span class="o">=</span><span class="s2">&quot;refs/heads/develop&quot;</span><span class="p">,</span>
        <span class="n">definitions</span><span class="o">=</span><span class="p">[</span><span class="o">&lt;</span><span class="n">Your</span> <span class="n">pipeline</span> <span class="n">definitionId</span><span class="o">&gt;</span><span class="p">],</span>
    <span class="p">)</span>

    <span class="c1"># Time out with 30m</span>
    <span class="k">if</span> <span class="n">step_time</span> <span class="o">==</span> <span class="mi">1800</span><span class="p">:</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span>
            <span class="sa">f</span><span class="s2">&quot;Time out as build pipeline is talking more than 30m.</span><span class="se">\n</span><span class="s2">Check the pipeline to investigate here </span><span class="si">{</span><span class="n">builds</span><span class="o">.</span><span class="n">value</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">url</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;_apis/build/Builds/&#39;</span><span class="p">,</span> <span class="s1">&#39;_build/results?buildId=&#39;</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span>
        <span class="p">)</span>
        <span class="n">os</span><span class="o">.</span><span class="n">sys</span><span class="o">.</span><span class="n">exit</span><span class="p">(</span><span class="s2">&quot;Task terminated&quot;</span><span class="p">)</span>

    <span class="c1"># Checking last result</span>
    <span class="k">if</span> <span class="n">builds</span><span class="o">.</span><span class="n">value</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">result</span> <span class="o">==</span> <span class="s2">&quot;failed&quot;</span><span class="p">:</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span>
            <span class="sa">f</span><span class="s2">&quot;Latest/last base pipeline is in filed state.</span><span class="se">\n</span><span class="s2">Check here </span><span class="si">{</span><span class="n">builds</span><span class="o">.</span><span class="n">value</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">url</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;_apis/build/Builds/&#39;</span><span class="p">,</span> <span class="s1">&#39;_build/results?buildId=&#39;</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span>
        <span class="p">)</span>
        <span class="n">os</span><span class="o">.</span><span class="n">sys</span><span class="o">.</span><span class="n">exit</span><span class="p">(</span><span class="s2">&quot;Task terminated&quot;</span><span class="p">)</span>

    <span class="c1"># Checking for current status </span>
    <span class="k">if</span> <span class="n">builds</span><span class="o">.</span><span class="n">value</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">status</span> <span class="o">==</span> <span class="s2">&quot;completed&quot;</span><span class="p">:</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Since base pipeline is ready moving ahead&quot;</span><span class="p">)</span>
        <span class="k">break</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span>
            <span class="sa">f</span><span class="s2">&quot;Respective pipeline&#39;s current status: </span><span class="si">{</span><span class="n">builds</span><span class="o">.</span><span class="n">value</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">status</span><span class="si">}</span><span class="s2"> and current period of waiting: </span><span class="si">{</span><span class="n">step_time</span><span class="si">}</span><span class="s2">s&quot;</span>
        <span class="p">)</span>
        <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mi">10</span><span class="p">)</span>
</code></pre></div>
</td></tr></table>
<div class="admonition info">
<p class="admonition-title">Info</p>
<p>I had even added a little extra logging information in case of failure to point out to failed run.
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span>1
2
3</pre></div></td><td class="code"><div class="highlight"><pre><span></span><code><span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span>
        <span class="sa">f</span><span class="s2">&quot;Latest/last base pipeline is in filed state.</span><span class="se">\n</span><span class="s2">Check here </span><span class="si">{</span><span class="n">builds</span><span class="o">.</span><span class="n">value</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">url</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;_apis/build/Builds/&#39;</span><span class="p">,</span> <span class="s1">&#39;_build/results?buildId=&#39;</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span>
    <span class="p">)</span>
</code></pre></div>
</td></tr></table>
and 
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span>1
2
3</pre></div></td><td class="code"><div class="highlight"><pre><span></span><code><span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span>
        <span class="sa">f</span><span class="s2">&quot;Respective pipeline&#39;s current status: </span><span class="si">{</span><span class="n">builds</span><span class="o">.</span><span class="n">value</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">status</span><span class="si">}</span><span class="s2"> and current period of waiting: </span><span class="si">{</span><span class="n">step_time</span><span class="si">}</span><span class="s2">s&quot;</span>
    <span class="p">)</span>
</code></pre></div>
</td></tr></table></p>
</div>
<hr />
<h3 id="3-integration-with-pipeline">3. Integration with Pipeline</h3>
<p>This part can vary with your use-case or preference. This is how I do it.</p>
<ol>
<li>I put the script at fix location in every repo</li>
<li>I set python version to be used as 3.x</li>
<li>I used pipeline variable to pass some parameters to the script. Like PAT which I store it as secret and then pass it the script. </li>
<li>Then finally I used <em>Run Python Script</em> task of Azure DevOps pipeline to run it.</li>
</ol>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17</pre></div></td><td class="code"><div class="highlight"><pre><span></span><code><span class="p p-Indicator">-</span> <span class="nt">task</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">UsePythonVersion@0</span>
  <span class="nt">inputs</span><span class="p">:</span>
    <span class="nt">versionSpec</span><span class="p">:</span> <span class="s">&#39;3.x&#39;</span>
    <span class="nt">addToPath</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">true</span>
    <span class="nt">architecture</span><span class="p">:</span> <span class="s">&#39;x64&#39;</span>

<span class="p p-Indicator">-</span> <span class="nt">task</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">CmdLine@2</span>
  <span class="nt">displayName</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">Install python package</span>
  <span class="nt">inputs</span><span class="p">:</span>
    <span class="nt">script</span><span class="p">:</span> <span class="s">&#39;python3</span><span class="nv"> </span><span class="s">-m</span><span class="nv"> </span><span class="s">pip</span><span class="nv"> </span><span class="s">install</span><span class="nv"> </span><span class="s">requests</span><span class="nv"> </span><span class="s">azure-devops&#39;</span>

<span class="p p-Indicator">-</span> <span class="nt">task</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">PythonScript@0</span>
  <span class="nt">displayName</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">Check build pipeline status</span>
  <span class="nt">inputs</span><span class="p">:</span>
    <span class="nt">scriptSource</span><span class="p">:</span> <span class="s">&#39;filePath&#39;</span>
    <span class="nt">scriptPath</span><span class="p">:</span> <span class="s">&#39;$(System.DefaultWorkingDirectory)/tests/base_pipeline_status.py&#39;</span>
    <span class="nt">arguments</span><span class="p">:</span> <span class="s">&#39;--personal_access_token</span><span class="nv"> </span><span class="s">$(PERSONALACCESSTOKEN)</span><span class="nv"> </span><span class="s">--repo_id</span><span class="nv"> </span><span class="s">e589ca4a-16ff-453b-b101-2a9f21542d76</span><span class="nv"> </span><span class="s">--pipeline_def_id</span><span class="nv"> </span><span class="s">183&#39;</span> <span class="c1"># You can see I am passing PAT token to PERSONALACCESSTOKEN from pipeline variable</span>
</code></pre></div>
</td></tr></table>
<div class="admonition tip">
<p class="admonition-title">Tip</p>
<p>I always run this task at beginning as to avoid running other task unnecessarily if this fails eventually.</p>
</div>
<p>Here is a screenshot of working of the logic</p>
<p><img alt="alt" src="../../assets/ado-pipeline-status-demo.png" title="Current ran failed due base pipeline failed" /></p>
<p><strong>Tags:</strong>
<a href="../../tags.html## &lt;span class=&quot;tag&quot;&gt;Azure DevOps&lt;/span&gt;">Azure Devops</a>,  <a href="../../tags.html## &lt;span class=&quot;tag&quot;&gt;CI/CD&lt;/span&gt;">CI/CD</a></p>
                
                  
                
              
              
                


              
            </article>
          </div>
        </div>
      </main>
      
        
<footer class="md-footer">
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-footer-copyright">
        
        Made with
        <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
          Material for MkDocs
        </a>
      </div>
      
  <div class="md-footer-social">
    
      
      
      <a href="mailto:desardaakash@gmail.com" target="_blank" rel="noopener" title="Contact me" class="md-footer-social__link">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><path d="M476 3.2L12.5 270.6c-18.1 10.4-15.8 35.6 2.2 43.2L121 358.4l287.3-253.2c5.5-4.9 13.3 2.6 8.6 8.3L176 407v80.5c0 23.6 28.5 32.9 42.5 15.8L282 426l124.6 52.2c14.2 6 30.4-2.9 33-18.2l72-432C515 7.8 493.3-6.8 476 3.2z"/></svg>
      </a>
    
      
      
        
        
      
      <a href="https://github.com/Akashdesarda" target="_blank" rel="noopener" title="github.com" class="md-footer-social__link">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 496 512"><path d="M165.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6zm-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3zm44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9zM244.8 8C106.1 8 0 113.3 0 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C428.2 457.8 496 362.9 496 252 496 113.3 383.5 8 244.8 8zM97.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1zm-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7zm32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1zm-11.4-14.7c-1.6 1-1.6 3.6 0 5.9 1.6 2.3 4.3 3.3 5.6 2.3 1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2z"/></svg>
      </a>
    
      
      
        
        
      
      <a href="https://www.linkedin.com/in/akashdesarda/" target="_blank" rel="noopener" title="www.linkedin.com" class="md-footer-social__link">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><path d="M416 32H31.9C14.3 32 0 46.5 0 64.3v383.4C0 465.5 14.3 480 31.9 480H416c17.6 0 32-14.5 32-32.3V64.3c0-17.8-14.4-32.3-32-32.3zM135.4 416H69V202.2h66.5V416zm-33.2-243c-21.3 0-38.5-17.3-38.5-38.5S80.9 96 102.2 96c21.2 0 38.5 17.3 38.5 38.5 0 21.3-17.2 38.5-38.5 38.5zm282.1 243h-66.4V312c0-24.8-.5-56.7-34.5-56.7-34.6 0-39.9 27-39.9 54.9V416h-66.4V202.2h63.7v29.2h.9c8.9-16.8 30.6-34.5 62.9-34.5 67.2 0 79.7 44.3 79.7 101.9V416z"/></svg>
      </a>
    
      
      
        
        
      
      <a href="https://www.medium.com/@desardaakash" target="_blank" rel="noopener" title="www.medium.com" class="md-footer-social__link">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><path d="M0 32v448h448V32H0zm372.2 106.1l-24 23c-2.1 1.6-3.1 4.2-2.7 6.7v169.3c-.4 2.6.6 5.2 2.7 6.7l23.5 23v5.1h-118V367l24.3-23.6c2.4-2.4 2.4-3.1 2.4-6.7V199.8l-67.6 171.6h-9.1L125 199.8v115c-.7 4.8 1 9.7 4.4 13.2l31.6 38.3v5.1H71.2v-5.1l31.6-38.3c3.4-3.5 4.9-8.4 4.1-13.2v-133c.4-3.7-1-7.3-3.8-9.8L75 138.1V133h87.3l67.4 148L289 133.1h83.2v5z"/></svg>
      </a>
    
  </div>

    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    <script id="__config" type="application/json">{"base": "../..", "features": [], "translations": {"clipboard.copy": "Copy to clipboard", "clipboard.copied": "Copied to clipboard", "search.config.lang": "en", "search.config.pipeline": "trimmer, stopWordFilter", "search.config.separator": "[\\s\\-]+", "search.placeholder": "Search", "search.result.placeholder": "Type to start searching", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.term.missing": "Missing"}, "search": "../../assets/javascripts/workers/search.fb4a9340.min.js", "version": null}</script>
    
    
      <script src="../../assets/javascripts/bundle.9b151c6a.min.js"></script>
      
    
  </body>
</html>